{"version":3,"sources":["PlatformWX.js"],"names":["module","exports","time","shareCb","getUserInfo","cb","wx","login","success","res","console","log","fail","init","self","showShareMenu","getSetting","authSetting","openSetting","onShareAppMessage","title","imageUrl","onShow","myDate","Date","temp_time","getTime","time_v","share","shareAppMessage","shareShortCutImage","canvas","cc","game","width","winSize","height","toTempFilePath","x","y","destWidth","destHeight","tempFilePath","rank","updateScore","score","window","postMessage","messageType","MAIN_MENU_NUM"],"mappings":"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","file":"PlatformWX.js","sourceRoot":"../../../../../../../assets/Script/Game/Platform/JS","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nmodule.exports = {\n    time: 0,\n    shareCb: null,\n    getUserInfo(cb) {\n        wx.login({\n            success: function () {\n                wx.getUserInfo({\n                    success: function (res) {\n                        console.log('获取玩家信息成功');\n                        console.log(res)\n                        cb(null, res);\n                    },\n                    fail: function () {\n                        console.log('获取玩家信息出错');\n                        cb(\"wx:getUserInfo_fail\", null);\n                    }\n                })\n            }\n        });\n    },\n    init() {\n        var self = this;\n        wx.showShareMenu();\n        //获取微信授权\n        wx.getSetting({\n            success: (res) => {\n                console.log(\"获取微信授权：\", res);\n                if (res.authSetting[\"scope.userInfo\"] == false) {\n                    wx.openSetting({\n\n                    })\n                }\n            }\n        });\n        /** 点击左上角-》转发 分享出去的内容 回调函数*/\n        wx.onShareAppMessage(() => {\n            //let shareData = gameApiCallback.shareButtonInfo();\n\n            return {\n                title: '猫鼠大战一触即发，谁是最终王者！',\n                imageUrl: 'images/share.png',\n                success: (res) => {\n\n                }\n            };\n\n        });\n\n        //onshow 也可能点击分享消息进入游戏\n        wx.onShow(res => {\n            let myDate = new Date();\n            let temp_time = myDate.getTime();\n            console.log(temp_time);\n            let time_v = temp_time - this.time;\n            if (this.shareCb && time_v >= 3000) {\n                console.log('111111111');\n                console.log(time_v);\n                this.shareCb();\n                this.shareCb = null;\n            } else {\n                console.log('22222222');\n                console.log(time_v);\n            }\n        });\n    },\n    share(cb) {\n        this.shareCb = cb;\n        let myDate = new Date();\n        this.time = myDate.getTime();\n        console.log(this.time);\n        var self = this;\n        wx.shareAppMessage({\n            // title: shareData.title,\n            // imageUrl: shareData.imageUrl,\n            // query: shareData.query,\n            title: '猫鼠大战一触即发，谁是最终王者！',\n            imageUrl: 'images/share.png',\n        });\n    },\n    shareShortCutImage(cb) {\n        //截屏图片\n        var canvas = cc.game.canvas;\n        var width = cc.winSize.width;\n        var height = cc.winSize.height;\n        var self = this;\n        canvas.toTempFilePath({\n            x: 0,\n            y: height * 0.25,\n            width: width,\n            height: width * 4 / 5,\n            destWidth: width,\n            destHeight: width * 4 / 5,\n            success(res) {\n                self.shareCb = cb;\n                let myDate = new Date();\n                self.time = myDate.getTime();\n                console.log(self.time);\n                wx.shareAppMessage({\n                    title: '好学生就是我，成语量超过了80%的微信好友。',\n                    imageUrl: res.tempFilePath,\n                    success: (res) => {\n                        if (cb) {\n                            cb();\n                        }\n                    }\n                })\n            }\n        })\n    },\n    rank() {\n\n    },\n    updateScore(score) {\n        window.wx.postMessage({\n            messageType: 3,\n            MAIN_MENU_NUM: \"x1\",\n            score: score,\n        });\n    },\n}\n"]}